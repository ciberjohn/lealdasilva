Docker LXC Fixer (containerd Downgrade Utility)A universal Bash script to fix the "Permission Denied" startup error when running Docker inside Proxmox LXC containers.üö® The ProblemIf you run Docker inside a Proxmox LXC container (specifically Unprivileged containers), you may encounter the following error after a recent apt upgrade:Error response from daemon: ... error during container init: open sysctl net.ipv4.ip_unprivileged_port_start file: reopen fd 8: permission deniedThis is caused by a regression/security change in containerd v2.x interacting with the shared kernel model of LXC.üõ† What This Script DoesThis script automates the manual fix process. It is designed to be OS-Agnostic (works on Ubuntu Jammy, Noble, Debian Bookworm, etc.) and performs the following safe-guards:OS Detection: Dynamically identifies your Linux distribution codename (e.g., noble, jammy, bookworm).Repository Repair: Checks your /etc/apt/sources.list.d/docker.list. If you upgraded your OS (e.g., 22.04 to 24.04) but the repo still points to the old version, this script automatically patches it to match your current OS.Smart Version Search: Queries your package manager for the latest safe v1.7.x version of containerd.io, avoiding the broken v2.x branch.Downgrade & Lock: Installs the safe version and applies an apt-mark hold to prevent nightly updates from breaking your system again.üöÄ UsageRun this script inside the LXC container (not on the Proxmox host).Option 1: Quick CreateCreate the file:nano fix_docker.sh
Paste the script content.Make it executable:chmod +x fix_docker.sh
Run with sudo:sudo ./fix_docker.sh
Option 2: One-Line Execution (if hosted)If you host this script on a gist or raw URL:curl -fsSL https://your-url/fix_docker.sh | sudo bash
üìã PrerequisitesRoot Access: The script requires sudo to modify package lists and install software.Official Docker Repos: This script works best with the official download.docker.com repositories. If you are using the default Ubuntu docker.io package, the script may fail to find the specific version history.üîÑ Future Maintenance (How to Revert)This script places a "hold" on the containerd.io package. This means it will never update automatically.Once Proxmox or Docker resolves the compatibility issue with containerd v2 (check community forums periodically), you can revert this fix by running:sudo apt-mark unhold containerd.io
sudo apt update && sudo apt upgrade
‚ö†Ô∏è DisclaimerThis script modifies system packages and repository lists. While tested on standard Proxmox LXC deployments (Ubuntu/Debian), always ensure you have backups of your container data before running infrastructure scripts.